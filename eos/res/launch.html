<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="moose.png">
    <link rel="stylesheet" href="./main.css" type="text/css" />
    <title>eper.ioâ„  Line Soft Phone</title>
</head>
<!--
Licensed under Creative Commons CC0.
To the extent possible under law, the author(s) have dedicated all copyright
neighboring rights to this software to the public domain worldwide.
This software is distributed without any warranty.
You should have received a copy of the CC0 Public Domain Dedication along wi
If not, see <https:#creativecommons.org/publicdomain/zero/1.0/legalcode>.
-->
<body class="transition-enabled" style="background-color: white; color:#693a26;">
    <div class="container">
        <p><br><br><br><br><br><br><br><br><br><br><br><br></p>
        <div class="centered-content">
            <div id="diagnostics"><p><a href="/documentation.html">Learn more.</a></p></div>
            <div onclick="call()">
                <img src="moose.png" alt="moose" style="width:0.6in; height:auto; padding-bottom: 1.00%; background: white">
            </div>
            <span class="texteditor-inline-color" style="color:#693a26;" id="button">Try to call</span>
        </div>
    </div>
    <script>
        function call() {
            if (document.getElementById("diagnostics").innerHTML !== "Launching...") {
                document.getElementById("diagnostics").innerHTML = "Launching..."
                let action = document.getElementById("button").innerText
                setTimeout(function () {
                    if (action === "Try to call") {
                        document.getElementById("button").innerText = 'Please wait'
                        setTimeout(function () {
                            if (document.getElementById("diagnostics").innerHTML === "Launching...") {
                                document.getElementById("diagnostics").innerHTML = "Launch timed out."
                                document.getElementById("button").innerText = "Try to call"
                                setTimeout(function () {
                                    document.getElementById("diagnostics").innerHTML = "Click on documentation to learn more."
                                }, 30000)
                            }
                        }, 700)
                        let xmlHttp = new XMLHttpRequest();
                        xmlHttp.open("GET", '/idle' + document.location.search, false);
                        xmlHttp.onerror = function () {
                            document.getElementById("diagnostics").innerHTML = "Connection failed."
                        }
                        xmlHttp.send(null);
                        console.log(xmlHttp.responseText);
                        if (xmlHttp.responseText.startsWith("http")) {
                            document.getElementById("diagnostics").innerHTML = "Launched."

                            if (window.innerWidth < window.innerHeight) {
                                // Mobile
                                window.location.href = xmlHttp.responseText.replace('#generate_leaf', '&mobile=1#generate_leaf')
                                console.log('switching to mobile bandwidth')
                            } else {
                                window.location.href = xmlHttp.responseText
                            }
                        }
                    }
                }, 10)
            }
        }
    </script>
</body>
</html>